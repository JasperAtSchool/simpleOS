local x,y = term.getSize()
term.setBackgroundColor(colors.cyan)
term.setTextColor(colors.white)
term.clear()
term.setCursorPos((x/2 - 9),(y/2))
term.write("simpleOS installer")

term.setCursorPos((x/2 - 11),(y/2 + 2))
term.setBackgroundColor(colors.red)
term.write("                     ")
term.setCursorPos((x/2 - 11),(y/2 + 2))
term.setBackgroundColor(colors.green)

function newload(current,index)
    term.setBackgroundColor(colors.green)
    term.setCursorPos(((x/2 - 11) + index),(y/2 + 2))
    term.write(" ")
    term.setCursorPos(1,(y/2 + 4))
    term.setBackgroundColor(colors.cyan)
    term.write("                                                                                                                                                                                                        ")
    term.setCursorPos((x/2 - (string.len(current)/2)),(y/2 + 4))
    term.setBackgroundColor(colors.cyan)
    term.write(current)
    os.sleep(0.1)
end

function httpinstall(url,path)
    local res = http.get(url)
    local file = fs.open(path,"w")
    file.write(res.readAll())
    file.close()
end

os.sleep(0.5)

--create dir
newload("creating ./libs",0)
fs.makeDir("./libs")
newload("creating ./libs/testos-ui",1)
fs.makeDir("./libs/testos-ui")
newload("creating ./libs/cobalt",2)
fs.makeDir("./libs/cobalt")
newload("creating ./libs/cobalt/lib",3)
fs.makeDir("./libs/cobalt/lib")
newload("creating ./libs/cobalt/lib/modules",4)
fs.makeDir("./libs/cobalt/lib/modules")
os.sleep(1)

newload("creating ./libs/cobalt/lib/modules/graphics",5)
fs.makeDir("./libs/cobalt/lib/modules/graphics")
newload("creating ./libs/cobalt/lib/modules/keyboard",6)
fs.makeDir("./libs/cobalt/lib/modules/keyboard")
newload("creating ./libs/cobalt/lib/modules/mouse",7)
fs.makeDir("./libs/cobalt/lib/modules/mouse")
newload("creating ./libs/cobalt/lib/modules/graphics/classes",8)
fs.makeDir("./libs/cobalt/lib/modules/graphics/classes")

term.setCursorPos((x/2 - 2),(y/2 + 2))
term.setBackgroundColor(colors.green)

newload("deleting old ./startup.lua",9)
fs.delete("./startup.lua")
os.sleep(1)
newload("creating ./startup.lua",9)
httpinstall("https://raw.githubusercontent.com/JasperAtSchool/simpleOS/main/startup.lua","./startup.lua")

os.sleep(2)


--install testos-ui
newload("creating ./main.lua",10)
shell.run("background","wget","https://raw.githubusercontent.com/JasperAtSchool/simpleOS/main/main.lua","./main.lua")
newload("creating ./libs/testos-ui/main.lua",11)
shell.run("background","wget","https://raw.githubusercontent.com/JasperAtSchool/simpleOS/main/libs/testos-ui/main.lua","./libs/testos-ui/main.lua")
os.sleep(2)
--cobalt instalation
newload("creating ./libs/cobalt/init.lua",12)
shell.run("background","wget","https://raw.githubusercontent.com/JasperAtSchool/simpleOS/main/libs/cobalt/init.lua","./libs/cobalt/init.lua")
newload("creating ./libs/cobalt/lib/clasp.lua",13)
shell.run("background","wget","https://raw.githubusercontent.com/JasperAtSchool/simpleOS/main/libs/cobalt/lib/clasp.lua","./libs/cobalt/lib/clasp.lua")
newload("creating ./libs/cobalt/lib/surface.lua",14)
shell.run("background","wget","https://raw.githubusercontent.com/JasperAtSchool/simpleOS/main/libs/cobalt/lib/surface.lua","./libs/cobalt/lib/surface.lua")

newload("creating ./libs/cobalt/lib/modules/graphics/init.lua",15)
shell.run("background","wget","https://raw.githubusercontent.com/JasperAtSchool/simpleOS/main/libs/cobalt/lib/modules/graphics/init.lua","./libs/cobalt/lib/modules/graphics/init.lua")
newload("creating ./libs/cobalt/lib/modules/keyboard/init.lua",16)
shell.run("background","wget","https://raw.githubusercontent.com/JasperAtSchool/simpleOS/main/libs/cobalt/lib/modules/keyboard/init.lua","./libs/cobalt/lib/modules/keyboard/init.lua")
newload("creating ./libs/cobalt/lib/modules/mouse/init.lua",17)
shell.run("background","wget","https://raw.githubusercontent.com/JasperAtSchool/simpleOS/main/libs/cobalt/lib/modules/mouse/init.lua","./libs/cobalt/lib/modules/mouse/init.lua")
os.sleep(2)

newload("creating ./libs/cobalt/lib/modules/graphics/classes/Canvas.lua",18)
shell.run("background","wget","https://raw.githubusercontent.com/JasperAtSchool/simpleOS/main/libs/cobalt/lib/modules/graphics/classes/Canvas.lua","./libs/cobalt/lib/modules/graphics/classes/Canvas.lua")
newload("creating ./libs/cobalt/lib/modules/graphics/classes/Drawable.lua",19)
shell.run("background","wget","https://raw.githubusercontent.com/JasperAtSchool/simpleOS/main/libs/cobalt/lib/modules/graphics/classes/Drawable.lua","./libs/cobalt/lib/modules/graphics/classes/Drawable.lua")
newload("creating ./libs/cobalt/lib/modules/graphics/classes/Image.lua",20)
shell.run("background","wget","https://raw.githubusercontent.com/JasperAtSchool/simpleOS/main/libs/cobalt/lib/modules/graphics/classes/Image.lua","./libs/cobalt/lib/modules/graphics/classes/Image.lua")

newload("restart...",21)
os.sleep(3)
os.reboot()
